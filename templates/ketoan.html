<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng qu·∫£n l√Ω thu ph√≠ chung c∆∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: linear-gradient(180deg, #1a237e 0%, #3949ab 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 0 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: #fff;
        }

        .nav-item i {
            width: 20px;
            margin-right: 10px;
        }

        .main-content {
            margin-left: 280px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #333;
        }

        .header h2 {
            color: #333;
            font-size: 1.8rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #666;
        }

        .content-section {
            display: none;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
        }

        .section-header h3 {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .section-body {
            padding: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .number {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-card .label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 10px 20px;
            border: 2px solid #e9ecef;
            transition: border-color 0.3s ease;
        }

        .search-box:focus-within {
            border-color: #667eea;
        }

        .search-box input {
            border: none;
            background: none;
            outline: none;
            padding: 5px 10px;
            font-size: 1rem;
            flex: 1;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2d3436;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-paid {
            background: #d4edda;
            color: #155724;
        }

        .status-unpaid {
            background: #f8d7da;
            color: #721c24;
        }

        .status-overdue {
            background: #fff3cd;
            color: #856404;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 3% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state h4 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #333;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .menu-toggle {
                display: block;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }

            .header {
                padding: 15px 20px;
            }

            .section-body {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>üè† BuildingPay</h1>
            <p>Qu·∫£n l√Ω thu ph√≠ chung c∆∞</p>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-section="dashboard">
                üìä T·ªïng quan
            </a>
            <a href="#" class="nav-item" data-section="residents">
                üë• C∆∞ d√¢n
            </a>
            <a href="#" class="nav-item" data-section="fees">
                üí∞ Qu·∫£n l√Ω ph√≠
            </a>
            <a href="#" class="nav-item" data-section="payments">
                üí≥ Thu chi
            </a>
            <a href="#" class="nav-item" data-section="reports">
                üìà B√°o c√°o
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Header -->
        <div class="header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <button class="menu-toggle" id="menuToggle">‚ò∞</button>
                <h2 id="pageTitle">T·ªïng quan</h2>
            </div>
            <div class="user-info">
                <span>üë§ Admin</span>
                <span>|</span>
                <span id="currentDate"></span>
            </div>
        </div>

        <!-- Dashboard Section -->
        <section class="content-section active" id="dashboard">
            <div class="section-header">
                <h3>üìä T·ªïng quan h·ªá th·ªëng</h3>
                <p>Th·ªëng k√™ t·ªïng quan v·ªÅ t√¨nh h√¨nh thu ph√≠ chung c∆∞</p>
            </div>
            <div class="section-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="number" id="totalResidents">{{ total_residents }}</div>
                        <div class="label">T·ªïng s·ªë c∆∞ d√¢n</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="totalRevenue">{{ total_revenue }}$</div>
                        <div class="label">Doanh thu th√°ng</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="paidCount">{{ paid_count }}</div>
                        <div class="label">ƒê√£ thanh to√°n</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="overdueCount">{{ unpaid_count }}</div>
                        <div class="label">Ch∆∞a thanh to√°n</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px;">
                        <h4 style="margin-bottom: 15px; color: #333;">üìà Th·ªëng k√™ theo th√°ng</h4>
                        <p style="color: #666;">Doanh thu th√°ng n√†y: <strong style="color: #28a745;">{{ total_revenue }}$</strong></p>
                        <p style="color: #666;">
                            So v·ªõi th√°ng tr∆∞·ªõc:
                            {% if change_percent is not None %}
                                {% if change_percent >= 0 %}
                                    <strong style="color: #28a745;">+{{ change_percent|floatformat:1 }}%</strong>
                                {% else %}
                                    <strong style="color: red;">{{ change_percent|floatformat:1 }}%</strong>
                                {% endif %}
                            {% else %}
                            <strong>Kh√¥ng c√≥ d·ªØ li·ªáu th√°ng tr∆∞·ªõc</strong>
                            {% endif %}
                        </p>
                        <p style="color: #666;">
                        T·ª∑ l·ªá thu:
                        {% if collection_rate is not None %}
                        <strong style="color: #17a2b8;">{{ collection_rate|floatformat:1 }}%</strong>
                        {% else %}
                        <strong>Kh√¥ng c√≥ d·ªØ li·ªáu</strong>
                        {% endif %}
                        </p>
                    </div>
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px;">
                        <h4 style="margin-bottom: 15px; color: #333;">‚ö†Ô∏è C·∫ßn ch√∫ √Ω</h4>
                        <p style="color: #666;">H√≥a ƒë∆°n qu√° h·∫°n: <strong style="color: #dc3545;">{{ overdue_bills }} h√≥a ƒë∆°n</strong></p>
                        <p style="color: #666;">T·ªïng n·ª£: 
                            {% if total_debt %}
                            <strong style="color: #dc3545;">{{ total_debt|floatformat:0 }}$</strong>
                            {% else %}
                            <strong style="color: #dc3545;">0$</strong>
                            {% endif %}
                        </p>
                        <p style="color: #666;">C·∫ßn li√™n h·ªá: 
                            <strong style="color: #ffc107;">
                            {{ need_contact_count }} c∆∞ d√¢n
                            </strong>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Residents Section -->
        <section class="content-section" id="residents">
    <div class="section-header">
        <h3>üë• Qu·∫£n l√Ω c∆∞ d√¢n</h3>
        <p>Danh s√°ch v√† th√¥ng tin c√°c c∆∞ d√¢n trong chung c∆∞</p>
    </div>
    <div class="section-body">
        <div class="controls">
                    <input type="text" id="residentSearch" name="q" placeholder="üîç T√¨m ki·∫øm c∆∞ d√¢n..." value="{{ search_query|default:'' }}">
            <button class="btn btn-primary" onclick="openResidentModal()">
                ‚ûï Th√™m c∆∞ d√¢n m·ªõi
            </button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>H·ªç t√™n</th>
                        <th>Gi·ªõi t√≠nh</th>
                        <th>T√™n kh√°c</th>
                        <th>Ng√†y sinh</th>
                        <th>N∆°i sinh</th>
                        <th>Nguy√™n qu√°n</th>
                        <th>D√¢n t·ªôc</th>
                        <th>Ngh·ªÅ nghi·ªáp</th>
                        <th>N∆°i l√†m vi·ªác</th>
                        <th>S·ªë CCCD</th>
                        <th>Ng√†y c·∫•p</th>
                        <th>N∆°i c·∫•p</th>
                        <th>Quan h·ªá v·ªõi ch·ªß h·ªô</th>
                        <th>T·∫°m tr√∫</th>
                        <th>Ghi ch√∫</th>
                        <th>Ng√†y nh·∫≠p h·ªô</th>
                    </tr>
                </thead>
    <tbody>
        {% for member in members %}
        <tr>
            <td>{{ member.full_name }}</td>
            <td>{{ member.get_gender_display }}</td>
            <td>{{ member.other_name }}</td>
            <td>{{ member.dob }}</td>
            <td>{{ member.place_of_birth }}</td>
            <td>{{ member.native_place }}</td>
            <td>{{ member.ethnic_group }}</td>
            <td>{{ member.occupation }}</td>
            <td>{{ member.place_of_work }}</td>
            <td>{{ member.cccd }}</td>
            <td>{{ member.issue_date }}</td>
            <td>{{ member.issued_by }}</td>
            <td>{{ member.relationship }}</td>
            <td>{% if member.is_temporary %}C√≥{% else %}Kh√¥ng{% endif %}</td>
            <td>{{ member.note }}</td>
            <td>{{ member.joined_at }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="16">Kh√¥ng c√≥ th√†nh vi√™n n√†o</td>
        </tr>
        {% endfor %}
                </tbody>
</table>

        </div>
    </div>
</section>

        <!-- Fees Section -->
        <section class="content-section" id="fees">
            <div class="section-header">
                <h3>üí∞ Qu·∫£n l√Ω ph√≠</h3>
                <p>Thi·∫øt l·∫≠p v√† qu·∫£n l√Ω c√°c lo·∫°i ph√≠ chung c∆∞</p>
            </div>
            <div class="section-body">
                <div class="controls">
                    <div class="search-box">
                        <input type="text" id="feeSearch" placeholder="üîç T√¨m ki·∫øm lo·∫°i ph√≠...">
                    </div>
                    <button class="btn btn-primary" onclick="openFeeModal()">
                        ‚ûï Th√™m lo·∫°i ph√≠ m·ªõi
                    </button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>T√™n ph√≠</th>
                                <th>M·ª©c ph√≠</th>
                                <th>ƒê∆°n v·ªã t√≠nh</th>
                                <th>M√¥ t·∫£</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="feesTable">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Payments Section -->
        <section class="content-section" id="payments">
            <div class="section-header">
                <h3>üí≥ Qu·∫£n l√Ω thu chi</h3>
                <p>Theo d√µi c√°c kho·∫£n thu v√† chi trong chung c∆∞</p>
            </div>
            <div class="section-body">
                <div class="controls">
                    <div class="search-box">
                        <input type="text" id="paymentSearch" placeholder="üîç T√¨m ki·∫øm giao d·ªãch...">
                    </div>
                    <button class="btn btn-primary" onclick="openPaymentModal()">
                        ‚ûï Th√™m giao d·ªãch m·ªõi
                    </button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ng√†y</th>
                                <th>CƒÉn h·ªô</th>
                                <th>Lo·∫°i ph√≠</th>
                                <th>S·ªë ti·ªÅn</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Ghi ch√∫</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTable">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section class="content-section" id="reports">
            <div class="section-header">
                <h3>üìà B√°o c√°o th·ªëng k√™</h3>
                <p>B√°o c√°o chi ti·∫øt v·ªÅ t√¨nh h√¨nh thu ph√≠</p>
            </div>
            <div class="section-body">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px;">
                        <h4 style="margin-bottom: 20px; color: #333;">üìä B√°o c√°o th√°ng</h4>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Ch·ªçn th√°ng:</label>
                            <input type="month" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <button class="btn btn-primary" style="width: 100%;">Xu·∫•t b√°o c√°o</button>
                    </div>

                    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px;">
                        <h4 style="margin-bottom: 20px; color: #333;">üìã Danh s√°ch n·ª£</h4>
                        <p style="color: #666; margin-bottom: 15px;">Xu·∫•t danh s√°ch c√°c h·ªô gia ƒë√¨nh c√≤n n·ª£ ph√≠</p>
                        <button class="btn btn-warning" style="width: 100%;">Xu·∫•t danh s√°ch n·ª£</button>
                    </div>

                    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px;">
                        <h4 style="margin-bottom: 20px; color: #333;">üí∞ B√°o c√°o doanh thu</h4>
                        <p style="color: #666; margin-bottom: 15px;">Th·ªëng k√™ doanh thu theo th·ªùi gian</p>
                        <button class="btn btn-success" style="width: 100%;">Xem b√°o c√°o</button>
                    </div>
                </div>

                <div style="margin-top: 30px; background: #f8f9fa; padding: 25px; border-radius: 10px;">
                    <h4 style="margin-bottom: 20px; color: #333;">üìà Bi·ªÉu ƒë·ªì th·ªëng k√™</h4>
                    <div style="height: 300px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #666;">
                        <p>Bi·ªÉu ƒë·ªì th·ªëng k√™ doanh thu theo th√°ng s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Resident Modal -->
    <div id="residentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="residentModalTitle">Th√™m c∆∞ d√¢n m·ªõi</h3>
                <span class="close" onclick="closeModal('residentModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="residentForm">
                    <div class="form-group">
                        <label for="apartmentNumber">S·ªë cƒÉn h·ªô *</label>
                        <input type="text" id="apartmentNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="ownerName">T√™n ch·ªß h·ªô *</label>
                        <input type="text" id="ownerName" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">S·ªë ƒëi·ªán tho·∫°i</label>
                        <input type="tel" id="phone">
                    </div>
                    <div class="form-group">
                        <label for="area">Di·ªán t√≠ch (m¬≤)</label>
                        <input type="number" id="area" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email">
                    </div>
                    <div class="form-group">
                        <label for="residentStatus">Tr·∫°ng th√°i</label>
                        <select id="residentStatus">
                            <option value="active">ƒêang ·ªü</option>
                            <option value="inactive">T·∫°m v·∫Øng</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="closeModal('residentModal')">H·ªßy</button>
                        <button type="submit" class="btn btn-success">L∆∞u</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Fee Modal -->
    <div id="feeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="feeModalTitle">Th√™m lo·∫°i ph√≠ m·ªõi</h3>
                <span class="close" onclick="closeModal('feeModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="feeForm">
                    <div class="form-group">
                        <label for="feeName">T√™n ph√≠ *</label>
                        <input type="text" id="feeName" required>
                    </div>
                    <div class="form-group">
                        <label for="feeAmount">M·ª©c ph√≠ *</label>
                        <input type="number" id="feeAmount" required step="1000">
                    </div>
                    <div class="form-group">
                        <label for="feeUnit">ƒê∆°n v·ªã t√≠nh</label>
                        <select id="feeUnit">
                            <option value="per_month">Th√°ng</option>
                            <option value="per_m2">m¬≤</option>
                            <option value="per_person">Ng∆∞·ªùi</option>
                            <option value="fixed">C·ªë ƒë·ªãnh</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="feeDescription">M√¥ t·∫£</label>
                        <textarea id="feeDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="feeStatus">Tr·∫°ng th√°i</label>
                        <select id="feeStatus">
                            <option value="active">√Åp d·ª•ng</option>
                            <option value="inactive">T·∫°m d·ª´ng</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="closeModal('feeModal')">H·ªßy</button>
                        <button type="submit" class="btn btn-success">L∆∞u</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="paymentModalTitle">Th√™m giao d·ªãch m·ªõi</h3>
                <span class="close" onclick="closeModal('paymentModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="paymentForm">
                    <div class="form-group">
                        <label for="paymentDate">Ng√†y thanh to√°n *</label>
                        <input type="date" id="paymentDate" required>
                    </div>
                    <div class="form-group">
                        <label for="paymentApartment">CƒÉn h·ªô *</label>
                        <select id="paymentApartment" required>
                            <option value="">Ch·ªçn cƒÉn h·ªô</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="paymentFeeType">Lo·∫°i ph√≠ *</label>
                        <select id="paymentFeeType" required>
                            <option value="">Ch·ªçn lo·∫°i ph√≠</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="paymentAmount">S·ªë ti·ªÅn *</label>
                        <input type="number" id="paymentAmount" required step="1000">
                    </div>
                    <div class="form-group">
                        <label for="paymentStatus">Tr·∫°ng th√°i</label>
                        <select id="paymentStatus">
                            <option value="paid">ƒê√£ thanh to√°n</option>
                            <option value="unpaid">Ch∆∞a thanh to√°n</option>
                            <option value="overdue">Qu√° h·∫°n</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="paymentNote">Ghi ch√∫</label>
                        <textarea id="paymentNote" rows="2"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="closeModal('paymentModal')">H·ªßy</button>
                        <button type="submit" class="btn btn-success">L∆∞u</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        let residents = [
            {
                id: 1,
                apartmentNumber: "A101",
                ownerName: "Nguy·ªÖn VƒÉn An",
                phone: "0901234567",
                area: 75.5,
                email: "an.nguyen@email.com",
                status: "active"
            },
            {
                id: 2,
                apartmentNumber: "A102",
                ownerName: "Tr·∫ßn Th·ªã B√¨nh",
                phone: "0912345678",
                area: 82.0,
                email: "binh.tran@email.com",
                status: "active"
            },
            {
                id: 3,
                apartmentNumber: "B203",
                ownerName: "L√™ VƒÉn C∆∞·ªùng",
                phone: "0923456789",
                area: 95.5,
                email: "cuong.le@email.com",
                status: "inactive"
            }
        ];

        let fees = [
            {
                id: 1,
                name: "Ph√≠ qu·∫£n l√Ω",
                amount: 15000,
                unit: "per_m2",
                description: "Ph√≠ qu·∫£n l√Ω chung c∆∞ h√†ng th√°ng",
                status: "active"
            },
            {
                id: 2,
                name: "Ph√≠ g·ª≠i xe m√°y",
                amount: 150000,
                unit: "per_month",
                description: "Ph√≠ g·ª≠i xe m√°y trong t·∫ßng h·∫ßm",
                status: "active"
            },
            {
                id: 3,
                name: "Ph√≠ n∆∞·ªõc",
                amount: 25000,
                unit: "per_m2",
                description: "Ph√≠ n∆∞·ªõc sinh ho·∫°t",
                status: "active"
            }
        ];

        let payments = [
            {
                id: 1,
                date: "2024-01-15",
                apartmentId: 1,
                feeId: 1,
                amount: 1132500,
                status: "paid",
                note: "Thanh to√°n ƒë·∫ßy ƒë·ªß"
            },
            {
                id: 2,
                date: "2024-01-10",
                apartmentId: 2,
                feeId: 1,
                amount: 1230000,
                status: "paid",
                note: ""
            },
            {
                id: 3,
                date: "2024-01-05",
                apartmentId: 3,
                feeId: 2,
                amount: 150000,
                status: "overdue",
                note: "Qu√° h·∫°n 15 ng√†y"
            }
        ];

        let editingId = null;
        let editingType = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateCurrentDate();
            renderAllData();
            updateDashboardStats();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Menu toggle for mobile
            document.getElementById('menuToggle').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('open');
            });

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.dataset.section;
                    showSection(section);
                    
                    // Update active nav item
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update page title
                    const titles = {
                        dashboard: 'T·ªïng quan',
                        residents: 'C∆∞ d√¢n',
                        fees: 'Qu·∫£n l√Ω ph√≠',
                        payments: 'Thu chi',
                        reports: 'B√°o c√°o'
                    };
                    document.getElementById('pageTitle').textContent = titles[section];
                    
                    // Close sidebar on mobile
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebar').classList.remove('open');
                    }
                });
            });

            // Search functionality
            document.getElementById('residentSearch').addEventListener('input', function() {
                filterResidents(this.value);
            });

            document.getElementById('feeSearch').addEventListener('input', function() {
                filterFees(this.value);
            });

            document.getElementById('paymentSearch').addEventListener('input', function() {
                filterPayments(this.value);
            });

            // Form submissions
            document.getElementById('residentForm').addEventListener('submit', saveResident);
            document.getElementById('feeForm').addEventListener('submit', saveFee);
            document.getElementById('paymentForm').addEventListener('submit', savePayment);

            // Modal close on outside click
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
        }

        // Show specific section
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName).classList.add('active');
        }

        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('vi-VN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('currentDate').textContent = dateStr;
        }

        // Update dashboard statistics
        // function updateDashboardStats() {
        //     document.getElementById('totalResidents').textContent = residents.length;
            
        //     const totalRevenue = payments
        //         .filter(p => p.status === 'paid')
        //         .reduce((sum, p) => sum + p.amount, 0);
        //     document.getElementById('totalRevenue').textContent = (totalRevenue / 1000000).toFixed(1) + 'M';
            
        //     document.getElementById('paidCount').textContent = payments.filter(p => p.status === 'paid').length;
        //     document.getElementById('overdueCount').textContent = payments.filter(p => p.status === 'overdue').length;
        // }

        // Render all data
        function renderAllData() {
            renderResidents();
            renderFees();
            renderPayments();
            populateSelectOptions();
        }

        // Render residents table
        function renderResidents(data = residents) {
            const tbody = document.getElementById('residentsTable');
            tbody.innerHTML = data.map(resident => `
                <tr>
                    <td><strong>${resident.apartmentNumber}</strong></td>
                    <td>${resident.ownerName}</td>
                    <td>${resident.phone || 'Ch∆∞a c√≥'}</td>
                    <td>${resident.area ? resident.area + ' m¬≤' : 'Ch∆∞a c√≥'}</td>
                    <td>
                        <span class="status-badge ${resident.status === 'active' ? 'status-paid' : 'status-unpaid'}">
                            ${resident.status === 'active' ? 'üü¢ ƒêang ·ªü' : '‚≠ï T·∫°m v·∫Øng'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-warning" style="padding: 8px 15px; margin-right: 5px;" onclick="editResident(${resident.id})">
                            ‚úèÔ∏è S·ª≠a
                        </button>
                        <button class="btn btn-danger" style="padding: 8px 15px;" onclick="deleteResident(${resident.id})">
                            üóëÔ∏è X√≥a
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Render fees table
        function renderFees(data = fees) {
            const tbody = document.getElementById('feesTable');
            tbody.innerHTML = data.map(fee => `
                <tr>
                    <td><strong>${fee.name}</strong></td>
                    <td>${formatCurrency(fee.amount)}</td>
                    <td>${getFeeUnitText(fee.unit)}</td>
                    <td>${fee.description || 'Kh√¥ng c√≥ m√¥ t·∫£'}</td>
                    <td>
                        <span class="status-badge ${fee.status === 'active' ? 'status-paid' : 'status-unpaid'}">
                            ${fee.status === 'active' ? 'üü¢ √Åp d·ª•ng' : '‚≠ï T·∫°m d·ª´ng'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-warning" style="padding: 8px 15px; margin-right: 5px;" onclick="editFee(${fee.id})">
                            ‚úèÔ∏è S·ª≠a
                        </button>
                        <button class="btn btn-danger" style="padding: 8px 15px;" onclick="deleteFee(${fee.id})">
                            üóëÔ∏è X√≥a
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Render payments table
        function renderPayments(data = payments) {
            const tbody = document.getElementById('paymentsTable');
            tbody.innerHTML = data.map(payment => {
                const resident = residents.find(r => r.id === payment.apartmentId);
                const fee = fees.find(f => f.id === payment.feeId);
                
                return `
                    <tr>
                        <td>${formatDate(payment.date)}</td>
                        <td>${resident ? resident.apartmentNumber : 'N/A'}</td>
                        <td>${fee ? fee.name : 'N/A'}</td>
                        <td>${formatCurrency(payment.amount)}</td>
                        <td>
                            <span class="status-badge ${getPaymentStatusClass(payment.status)}">
                                ${getPaymentStatusText(payment.status)}
                            </span>
                        </td>
                        <td>${payment.note || 'Kh√¥ng c√≥'}</td>
                        <td>
                            <button class="btn btn-warning" style="padding: 8px 15px; margin-right: 5px;" onclick="editPayment(${payment.id})">
                                ‚úèÔ∏è S·ª≠a
                            </button>
                            <button class="btn btn-danger" style="padding: 8px 15px;" onclick="deletePayment(${payment.id})">
                                üóëÔ∏è X√≥a
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Populate select options
        function populateSelectOptions() {
            const apartmentSelect = document.getElementById('paymentApartment');
            apartmentSelect.innerHTML = '<option value="">Ch·ªçn cƒÉn h·ªô</option>' +
                residents.map(r => `<option value="${r.id}">${r.apartmentNumber} - ${r.ownerName}</option>`).join('');

            const feeSelect = document.getElementById('paymentFeeType');
            feeSelect.innerHTML = '<option value="">Ch·ªçn lo·∫°i ph√≠</option>' +
                fees.filter(f => f.status === 'active').map(f => `<option value="${f.id}">${f.name}</option>`).join('');
        }

        // Filter functions
        function filterResidents(searchTerm) {
            const filtered = residents.filter(r => 
                r.apartmentNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
                r.ownerName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (r.phone && r.phone.includes(searchTerm))
            );
            renderResidents(filtered);
        }

        function filterFees(searchTerm) {
            const filtered = fees.filter(f => 
                f.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (f.description && f.description.toLowerCase().includes(searchTerm.toLowerCase()))
            );
            renderFees(filtered);
        }

        function filterPayments(searchTerm) {
            const filtered = payments.filter(p => {
                const resident = residents.find(r => r.id === p.apartmentId);
                const fee = fees.find(f => f.id === p.feeId);
                return (resident && resident.apartmentNumber.toLowerCase().includes(searchTerm.toLowerCase())) ||
                       (fee && fee.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                       (p.note && p.note.toLowerCase().includes(searchTerm.toLowerCase()));
            });
            renderPayments(filtered);
        }

        // Modal functions
        function openResidentModal() {
            document.getElementById('residentModal').style.display = 'block';
            document.getElementById('residentModalTitle').textContent = 'Th√™m c∆∞ d√¢n m·ªõi';
            document.getElementById('residentForm').reset();
            editingId = null;
            editingType = 'resident';
        }

        function openFeeModal() {
            document.getElementById('feeModal').style.display = 'block';
            document.getElementById('feeModalTitle').textContent = 'Th√™m lo·∫°i ph√≠ m·ªõi';
            document.getElementById('feeForm').reset();
            editingId = null;
            editingType = 'fee';
        }

        function openPaymentModal() {
            document.getElementById('paymentModal').style.display = 'block';
            document.getElementById('paymentModalTitle').textContent = 'Th√™m giao d·ªãch m·ªõi';
            document.getElementById('paymentForm').reset();
            document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
            editingId = null;
            editingType = 'payment';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            editingId = null;
            editingType = null;
        }

        // Save functions
        function saveResident(e) {
            e.preventDefault();
            
            const formData = {
                apartmentNumber: document.getElementById('apartmentNumber').value,
                ownerName: document.getElementById('ownerName').value,
                phone: document.getElementById('phone').value,
                area: parseFloat(document.getElementById('area').value) || 0,
                email: document.getElementById('email').value,
                status: document.getElementById('residentStatus').value
            };

            if (editingId) {
                const index = residents.findIndex(r => r.id === editingId);
                residents[index] = { ...residents[index], ...formData };
            } else {
                const newId = Math.max(...residents.map(r => r.id), 0) + 1;
                residents.push({ id: newId, ...formData });
            }

            renderResidents();
            populateSelectOptions();
            updateDashboardStats();
            closeModal('residentModal');
        }

        function saveFee(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('feeName').value,
                amount: parseInt(document.getElementById('feeAmount').value),
                unit: document.getElementById('feeUnit').value,
                description: document.getElementById('feeDescription').value,
                status: document.getElementById('feeStatus').value
            };

            if (editingId) {
                const index = fees.findIndex(f => f.id === editingId);
                fees[index] = { ...fees[index], ...formData };
            } else {
                const newId = Math.max(...fees.map(f => f.id), 0) + 1;
                fees.push({ id: newId, ...formData });
            }

            renderFees();
            populateSelectOptions();
            closeModal('feeModal');
        }

        function savePayment(e) {
            e.preventDefault();
            
            const formData = {
                date: document.getElementById('paymentDate').value,
                apartmentId: parseInt(document.getElementById('paymentApartment').value),
                feeId: parseInt(document.getElementById('paymentFeeType').value),
                amount: parseInt(document.getElementById('paymentAmount').value),
                status: document.getElementById('paymentStatus').value,
                note: document.getElementById('paymentNote').value
            };

            if (editingId) {
                const index = payments.findIndex(p => p.id === editingId);
                payments[index] = { ...payments[index], ...formData };
            } else {
                const newId = Math.max(...payments.map(p => p.id), 0) + 1;
                payments.push({ id: newId, ...formData });
            }

            renderPayments();
            updateDashboardStats();
            closeModal('paymentModal');
        }

        // Edit functions
        function editResident(id) {
            const resident = residents.find(r => r.id === id);
            if (!resident) return;

            document.getElementById('apartmentNumber').value = resident.apartmentNumber;
            document.getElementById('ownerName').value = resident.ownerName;
            document.getElementById('phone').value = resident.phone || '';
            document.getElementById('area').value = resident.area || '';
            document.getElementById('email').value = resident.email || '';
            document.getElementById('residentStatus').value = resident.status;

            document.getElementById('residentModalTitle').textContent = 'Ch·ªânh s·ª≠a c∆∞ d√¢n';
            document.getElementById('residentModal').style.display = 'block';
            editingId = id;
            editingType = 'resident';
        }

        function editFee(id) {
            const fee = fees.find(f => f.id === id);
            if (!fee) return;

            document.getElementById('feeName').value = fee.name;
            document.getElementById('feeAmount').value = fee.amount;
            document.getElementById('feeUnit').value = fee.unit;
            document.getElementById('feeDescription').value = fee.description || '';
            document.getElementById('feeStatus').value = fee.status;

            document.getElementById('feeModalTitle').textContent = 'Ch·ªânh s·ª≠a lo·∫°i ph√≠';
            document.getElementById('feeModal').style.display = 'block';
            editingId = id;
            editingType = 'fee';
        }

        function editPayment(id) {
            const payment = payments.find(p => p.id === id);
            if (!payment) return;

            document.getElementById('paymentDate').value = payment.date;
            document.getElementById('paymentApartment').value = payment.apartmentId;
            document.getElementById('paymentFeeType').value = payment.feeId;
            document.getElementById('paymentAmount').value = payment.amount;
            document.getElementById('paymentStatus').value = payment.status;
            document.getElementById('paymentNote').value = payment.note || '';

            document.getElementById('paymentModalTitle').textContent = 'Ch·ªânh s·ª≠a giao d·ªãch';
            document.getElementById('paymentModal').style.display = 'block';
            editingId = id;
            editingType = 'payment';
        }

        // Delete functions
        function deleteResident(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c∆∞ d√¢n n√†y?')) {
                residents = residents.filter(r => r.id !== id);
                renderResidents();
                populateSelectOptions();
                updateDashboardStats();
            }
        }

        function deleteFee(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a lo·∫°i ph√≠ n√†y?')) {
                fees = fees.filter(f => f.id !== id);
                renderFees();
                populateSelectOptions();
            }
        }

        function deletePayment(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a giao d·ªãch n√†y?')) {
                payments = payments.filter(p => p.id !== id);
                renderPayments();
                updateDashboardStats();
            }
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('vi-VN');
        }

        function getFeeUnitText(unit) {
            const units = {
                'per_month': 'Th√°ng',
                'per_m2': 'm¬≤',
                'per_person': 'Ng∆∞·ªùi',
                'fixed': 'C·ªë ƒë·ªãnh'
            };
            return units[unit] || unit;
        }

        function getPaymentStatusClass(status) {
            const classes = {
                'paid': 'status-paid',
                'unpaid': 'status-unpaid',
                'overdue': 'status-overdue'
            };
            return classes[status] || 'status-unpaid';
        }

        function getPaymentStatusText(status) {
            const texts = {
                'paid': 'üü¢ ƒê√£ thanh to√°n',
                'unpaid': '‚≠ï Ch∆∞a thanh to√°n',
                'overdue': 'üî¥ Qu√° h·∫°n'
            };
            return texts[status] || status;
        }
    </script>
</body>
</html>